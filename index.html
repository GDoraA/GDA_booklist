<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Booklist</title>

    <!-- Font Awesome ikonok -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
        <meta name="theme-color" content="#a7c7ff">

        <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }
        </script>

</head>

<body>

<!-- FEJL√âC -->
<div class="header">
    <div class="header-title">
        üìñ GDA k√∂nyvei
    </div>
</div>



<div class="container">


    <nav>
        <button id="tab_lista" class="active" onclick="mutat('lista')">
            üìù Lista
        </button>

        <button id="tab_import" onclick="mutat('import')">
            üì• Import
        </button>
    </nav>


    <!-- LISTA -->
    <div class="page" id="lista">
        <h1>K√∂nyvlista</h1>

            <div class="stats-bar">
                <div class="stat-card" style="background:#dce8ff;color:#335a96;">
                    √ñsszes k√∂nyv: <span id="stat_total">0</span>
                </div>

                <div class="stat-card" style="background:#f9e5ef;color:#9b3d68;">
                    Megv√°s√°rolt: <span id="stat_purchased">0</span>
                </div>

                <div class="stat-card" style="background:#ececef;color:#5a5d6b;">
                    Nincs m√©g meg: <span id="stat_missing">0</span>
                </div>
            </div>



        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px;">
            <button class="btn btn-primary" onclick="openBookModal('new')">‚ûï √öj k√∂nyv felv√©tele</button>
            <button class="btn btn-secondary" onclick="betoltesLista()">üîÑ Lista friss√≠t√©se</button>
        </div>

        <h3>üîç Sz≈±r√©s</h3>
        <div class="filters">
            <div>
                <label>Szerz≈ë</label><br>
                <input id="ls_szerzo" list="authors_list_filter" oninput="listaSzures()">
                <datalist id="authors_list_filter"></datalist>
            </div>
            <div>
                <label>C√≠m</label><br>
                <input id="ls_cim" oninput="listaSzures()">
            </div>
            <div>
                <label>Sorozat</label><br>
                <input id="ls_sorozat" list="series_list_filter" oninput="listaSzures()">
                <datalist id="series_list_filter"></datalist>
            </div>
            <div>
                <label>√âv (t√≥l)</label><br>
                <input id="ls_ev_min" type="number" min="1" max="9999" step="1" oninput="validateYearFilter(this); listaSzures()">
            </div>
            <div>
                <label>√âv (ig)</label><br>
                <input id="ls_ev_max" type="number" min="1" max="9999" step="1" oninput="validateYearFilter(this); listaSzures()">
            </div>
            <div>
                <label>Megv√°s√°rolva</label><br>
                <select id="ls_megv" onchange="listaSzures()">
                    <option value="">Mindegy</option>
                    <option value="x">Csak megvett</option>
                    <option value="no">Csak nincs meg</option>
                </select>
            </div>
        </div>

        <div class="table-wrapper mt-8">
            <div class="table-scroll">
                <table id="tabla_lista">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="setSort('Author')">Szerz≈ë</th>
                            <th class="sortable" onclick="setSort('Title')">C√≠m</th>
                            <th class="sortable" onclick="setSort('Series')">Sorozat</th>
                            <th class="sortable" onclick="setSort('Year')">√âv</th>
                            <th class="sortable" onclick="setSort('Purchased')">Megv.</th>
                            <th class="sortable" onclick="setSort('For_sale')">Elad√≥</th>
                            <th class="sortable" onclick="setSort('Price')">√År</th>
                            <th>M≈±velet</th>
                        </tr>
                    </thead>

                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- IMPORT -->
    <div class="page" id="import">
        <h1>CSV / TSV import√°l√°sa</h1>

        <p>Elv√°rt strukt√∫ra (List f√ºl fejl√©c sorrendje):</p>
        <pre>ID,Author,Title,Original_Title,Previous_Title,Series,Number,URL,Year,Purchased,For_sale</pre>

        <p>A f√°jl lehet vessz≈ëvel, pontosvessz≈ëvel vagy TAB-bal tagolt.</p>

        <input type="file" id="csvFile" accept=".csv,.tsv,.txt"><br><br>
        <button class="btn btn-primary" onclick="importCsv()">Import√°l√°s</button>

        <h3>Eredm√©ny:</h3>
        <div id="importResult"></div>
    </div>

    <h3 style="margin-top:22px;">Log</h3>
    <div id="log"></div>

</div> <!-- /container -->

<!-- MODAL: √öj k√∂nyv / Szerkeszt√©s ‚Äì k√∂z√∂s ≈±rlap -->
<div id="bookModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h2 id="modalTitle">K√∂nyv</h2>
            <button class="modal-close-btn" onclick="closeBookModal()">&times;</button>
        </div>

        <input type="hidden" id="bm_id">
        <input type="hidden" id="bm_existing_url">

        <div class="modal-grid">
            <div>
                <label>Szerz≈ë *</label><br>
                <input id="bm_szerzo" list="authors_list_modal">
                <datalist id="authors_list_modal"></datalist>
            </div>
            <div>
                <label>C√≠m *</label><br>
                <input id="bm_cim">
            </div>
            <div>
                <label>Eredeti c√≠m</label><br>
                <input id="bm_eredeti">
            </div>
            <div>
                <label>Kor√°bbi c√≠m</label><br>
                <input id="bm_korabbi">
            </div>
            <div>
                <label>Sorozat</label><br>
                <input id="bm_sorozat" list="series_list_modal">
                <datalist id="series_list_modal"></datalist>
            </div>
            <div>
                <label>Ssz</label><br>
                <input id="bm_ssz">
            </div>
            <div>
                <label>√âv</label><br>
                <input id="bm_ev" type="number" min="1" max="9999" step="1" oninput="validateYearFilter(this)">
            </div>
            <div>
                <label>URL (ha nincs felt√∂lt√∂tt k√©p)</label><br>
                <input id="bm_url">
            </div>
            <div style="display:flex;align-items:center;gap:8px;margin-top:18px;">
                <input type="checkbox" id="bm_purchased" style="width:auto;">
                <label style="margin:0;">Megv√°s√°rolva</label>
            </div>
            <div style="display:flex;align-items:center;gap:8px;margin-top:18px;">
                <input type="checkbox" id="bm_forsale" style="width:auto;">
                <label style="margin:0;">Elad√≥</label>
            </div>
            <div>
                <label>√År</label><br>
                <input id="bm_ar" type="number" step="1">
            </div>

            <div>
                <label>Megjegyz√©s</label><br>
                <input id="bm_megjegy">
            </div>

        </div>

        <div class="modal-image-section">
            <label>Bor√≠t√≥k√©p</label><br>
            <input type="file" id="bm_file" accept="image/*"><br>
            <img id="bm_preview" alt="Bor√≠t√≥ el≈ën√©zet">
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeBookModal()">M√©gse</button>
            <button class="btn btn-primary" onclick="saveBookFromModal()">Ment√©s</button>
        </div>
    </div>
</div>

<script src="app.js"></script>
</body>
</html>
